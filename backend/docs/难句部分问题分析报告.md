# 项目二难句部分 (Sentence Surgery) 代码问题分析报告

**时间戳**: 2025-12-19 11:00:00

## 1. 核心逻辑问题

### 1.1 数据加载限制 (High)
- **现象**: 在 `frontend/store.ts` 中硬编码了 `apiVersion.sentence_surgeries.slice(0, 1)`。
- **影响**: 即使后端返回多个长难句，前端也只能显示和练习第一句。
- **建议**: 移除 `slice(0, 1)`，支持加载完整的难句列表。

### 1.2 数据格式不匹配 (High)
- **现象**: `apiService.ts` 定义 `chunks_visual` 为对象格式 `{ core: string[], modifier: string[] }`，但 `dataTransform.ts` 的转换逻辑却期望它是数组格式 `[{ text: string, type: string }]`。
- **影响**: 导致从项目 1 导入的真实数据可能无法正确解析，显示为"暂无长难句数据"。
- **建议**: 统一前后端数据协议，建议采用数组格式以保持语序。

## 2. 功能实现缺失

### 2.1 跟读内化环节缺失 (Medium)
- **PRD 要求**: Phase 5 Step 4 要求学生跟读"瘦身"后的主干句。
- **现状**: 前端 UI 完全没有实现录音跟读和发音评估的交互。
- **建议**: 集成 `assessPronunciation` 接口，在主干句展示后引导学生跟读。

### 2.2 视觉切分动画不完整 (Medium)
- **PRD 要求**: 修饰语应有 Fade Out (变灰) 效果，主干应有高亮发光效果。
- **现状**: 仅实现了简单的 `isRemoved` 隐藏逻辑，缺乏视觉冲击力和"降维"感。
- **建议**: 优化 Framer Motion 动画，实现变灰半透明效果而非直接消失。

## 3. 交互与 UI 问题

### 3.1 句子导航不明显 (Low)
- **现象**: 缺乏明显的"上一句/下一句"切换按钮。
- **影响**: 教师和学生难以在多个难句间切换。
- **建议**: 在底部进度条两侧增加切换箭头。

### 3.2 AI 工具调用深度不足 (Medium)
- **现象**: `surgery_tutor.md` 中定义了 `show_sentence_structure` 等工具，但前端实现较为单一。
- **影响**: 无法展示复杂的语法树或结构化分析。
- **建议**: 增强 `showStructure` 状态下的视觉表现，如增加连接线或语法标签。

## 4. 数据持久化问题

### 4.1 进度保存缺失 (Low)
- **现象**: 页面刷新或阶段切换后，难句拆解的进度（哪些部分已移除）会重置。
- **影响**: 教学连续性受阻。
- **建议**: 将拆解状态同步至后端或本地缓存。

---
**分析结论**: 目前难句部分已具备基础框架，但**数据协议一致性**和**跟读功能**是影响 V1.0 交付的核心瓶颈。
