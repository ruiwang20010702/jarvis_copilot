# 项目1与项目2关联性分析报告

## 1. 项目定位对比

| 维度 | 项目1 (jarvis_project_1) | 项目2 (jarvis_project_2) |
|-----|-------------------------|-------------------------|
| **项目名称** | S9 智能分层内容生产后台 | S9 课堂交互与 Jarvis Copilot 系统 |
| **核心定位** | **内容工厂** - 生产端 | **课堂交互** - 消费端 |
| **用户角色** | 教研人员/内容生产者 | 教练 + 学生 |
| **核心功能** | AI 裂变生成 L0-L3 四版本文章 | 实时课堂交互 + AI Copilot 辅助 |

---

## 2. 上下游关系图

```
┌─────────────────────────────────────────────────────────────────────┐
│                         项目1: 内容生产后台                           │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐      │
│  │ 上传原文  │ →  │ AI 裂变  │ →  │ 智能出题 │ →  │ 长难句手术 │ →  入库  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘      │
└─────────────────────────────────────────────────────────────────────┘
                                    ↓
                              [数据包下发]
                                    ↓
┌─────────────────────────────────────────────────────────────────────┐
│                         项目2: 课堂交互系统                           │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐      │
│  │  Phase 2 │    │  Phase 3 │    │  Phase 4 │    │  Phase 5 │      │
│  │  实战阅读 │ →  │  精准带练 │ →  │  生词攻克 │ →  │  难句突破 │      │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. 数据复用分析

### 3.1 项目1现有数据库表

| 表名 | 项目2是否可用 | 复用场景 | 问题 |
|-----|-------------|--------|------|
| `articles` | ✅ 可用 | 原文展示、分层阅读 | 无 |
| `versions` | ✅ 可用 | L0-L3 分层内容 | 无 |
| `questions` | ✅ 可用 | Phase 2 答题卡 | 🔴 缺少 AI Tutor 解析数据 |
| `sentence_surgeries` | ✅ 可用 | Phase 5 难句突破 | 🟡 缺少视觉切分动画数据 |
| `analytics_events` | ❌ 不适用 | 仅用于生产端埋点 | - |

### 3.2 可直接复用的数据 ✅

项目1的以下数据可以**直接**供项目2使用：

1. **文章内容** (`versions.content`)
   - Phase 2 实战阅读的文本展示
   - 基础模式 vs 进阶模式的文本来源

2. **题目数据** (`questions`)
   - Phase 2 答题卡的题干、选项、正确答案
   - Phase 3 带练的题目基础信息

3. **长难句基础数据** (`sentence_surgeries`)
   - 原始句子、翻译、结构分析
   - Phase 5 难句突破的文本素材

---

## 4. 🔴 数据缺失与需新增字段

### 4.1 `questions` 表需新增

项目2 的 **Phase 3 精准带练** 需要以下数据，当前项目1不提供：

| 新增字段建议 | 类型 | 用途 |
|------------|------|------|
| `ai_tutor_script` | JSON | 苏格拉底话术脚本 (Copilot Script) |
| `error_tags` | JSON | 错误归因标签 (如"偷换概念"、"指代错误") |
| `trap_type` | STRING | 干扰项陷阱类型 |
| `difficulty_by_level` | JSON | 分层难度提示 (L0/L3 不同话术) |

**示例数据结构**:
```json
{
  "ai_tutor_script": {
    "L0": "这道题问的是 Why，请在原文画出原因句...",
    "L3": "请分析这句话的逻辑重心是前半句还是后半句？"
  },
  "error_tags": ["偷换概念", "过度推断"],
  "trap_type": "范围扩大"
}
```

### 4.2 `sentence_surgeries` 表需新增

项目2 的 **Phase 5 难句突破** 需要动画数据：

| 新增字段建议 | 类型 | 用途 |
|------------|------|------|
| `chunks_visual` | JSON | 视觉切分数据 (主干/修饰语分离动画) |
| `core_sentence` | TEXT | 瘦身后的主干句 |
| `core_audio_url` | STRING | 主干句音频 URL |
| `coach_script` | JSON | AI 讲解逐字稿 |

**示例数据结构**:
```json
{
  "chunks_visual": {
    "core": ["The boy", "is", "my brother"],
    "modifier": ["who was wearing a red hat and standing by the door"]
  },
  "core_sentence": "The boy is my brother.",
  "coach_script": "Alex，看到这个 who 了吗？它像个钩子，把后面这一长串都挂起来了..."
}
```

### 4.3 需新增的表

项目2 需要以下**全新**的表：

| 新表名 | 用途 |
|-------|------|
| `user_profiles` | 学生画像 (Level, 兴趣标签, 完课率) - Phase 1 破冰 |
| `vocab_cards` | 3D 词卡数据 (音节切分、AI 助记、语境句) - Phase 4 |
| `session_logs` | 课堂实时数据 (looked_up_words, reading_speed, response_rate) |
| `coach_scripts` | 预制话术库 (开场白、破冰话术、鼓励语) |

---

## 5. 兼容性问题汇总

| 问题类型 | 具体问题 | 解决方案 |
|---------|---------|---------|
| **结构不匹配** | `sentence_surgeries.structure_data` 是语法树格式，项目2需要视觉动画格式 | 在项目1出库时，增加"视觉切分"转换步骤 |
| **数据维度缺失** | 题目缺少 AI Tutor 话术 | 在项目1的 Step 4 智能出题环节，增加"话术生成"流程 |
| **实时数据缺失** | 项目1无学生行为数据 | 项目2需独立建设实时数据采集和存储模块 |
| **词汇数据缺失** | 项目1无单词级别的详细数据 | 需在项目2新建 `vocab_cards` 表，或扩展项目1 |

---

## 6. 建议的解决路径

### 方案 A: 扩展项目1数据库 ✅ 已实施 (2025-12-10)

在项目1的生产流程中增加以下环节：

1. ✅ **Step 4+**: 智能出题时，同时生成 `ai_tutor_script` 和 `error_tags`
2. ✅ **Step 5+**: 长难句手术时，同时生成 `chunks_visual` 和 `coach_script`
3. ✅ **Step 实时查词**: 新增 `/api/vocab/lookup` 实时查词服务，支持 TTS 发音

**已完成的修改**：
- `models.py`: Question 新增 3 字段 + SentenceSurgery 新增 4 字段 + VocabCard 新表
- `question_service.py`: Prompt 扩展生成 AI Tutor 话术
- `surgery_service.py`: Prompt 扩展生成视觉切分数据
- `vocab_service.py`: 新增实时查词服务 (LLM + TTS)

### 方案 B: 项目2独立数据层

项目2建立独立的数据处理层：

1. 从项目1获取基础数据 (articles, versions, questions, sentence_surgeries)
2. 通过 AI 服务实时生成缺失数据 (Copilot 话术、视觉切分等)
3. 缺点：增加延迟，需要实时 AI 调用

---

## 7. 结论

| 维度 | 结论 |
|-----|------|
| **关联性** | 项目1是项目2的**上游数据源**，两者是"内容工厂 → 课堂消费"的生产-消费关系 |
| **可复用性** | ✅ 约 **80%** 的数据可直接复用（文章、题目+话术、长难句+视觉切分、词卡） |
| **缺失数据** | ✅ 已通过方案A补齐（AI 话术、视觉动画、词卡实时查询） |
| **实施状态** | ✅ **方案A已实施** (2025-12-10) |

